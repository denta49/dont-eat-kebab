<VirtualHost *:80>
    ServerName api.dietka.przemox49.usermd.net
    DocumentRoot /domains/api.dietka.przemox49.usermd.net/public_python
    
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    # CORS Headers
    Header always set Access-Control-Allow-Origin "https://dietka.przemox49.usermd.net"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Allow-Credentials "true"
    
    # Handle OPTIONS preflight
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L,E=HTTP_ORIGIN:%{HTTP:ORIGIN}]
    
    # If the request is OPTIONS, return these headers and exit
    Header always set Access-Control-Allow-Origin "%{HTTP_ORIGIN}e" env=HTTP_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" env=HTTP_ORIGIN
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization" env=HTTP_ORIGIN
    Header always set Access-Control-Allow-Credentials "true" env=HTTP_ORIGIN
    Header always set Access-Control-Max-Age "600" env=HTTP_ORIGIN
    
    # Enable required modules
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "DENY"
        Header set X-XSS-Protection "1; mode=block"
    </IfModule>
</VirtualHost>

# SSL configuration (if you have SSL certificate)
<VirtualHost *:443>
    ServerName api.dietka.przemox49.usermd.net
    DocumentRoot /domains/api.dietka.przemox49.usermd.net/public_python
    
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key
    
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    # Same CORS headers as above
    Header always set Access-Control-Allow-Origin "https://dietka.przemox49.usermd.net"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Allow-Credentials "true"
    
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L,E=HTTP_ORIGIN:%{HTTP:ORIGIN}]
    
    Header always set Access-Control-Allow-Origin "%{HTTP_ORIGIN}e" env=HTTP_ORIGIN
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" env=HTTP_ORIGIN
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization" env=HTTP_ORIGIN
    Header always set Access-Control-Allow-Credentials "true" env=HTTP_ORIGIN
    Header always set Access-Control-Max-Age "600" env=HTTP_ORIGIN
</VirtualHost>